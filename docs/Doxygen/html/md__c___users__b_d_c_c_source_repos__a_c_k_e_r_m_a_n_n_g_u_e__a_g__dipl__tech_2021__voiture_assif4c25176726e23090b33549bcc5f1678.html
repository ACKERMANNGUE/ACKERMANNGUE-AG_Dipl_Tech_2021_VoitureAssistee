<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Code source du projet Voiture Assistée: Python library to interact with Move Hub / PoweredUp Hubs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_voiture_flatdesign_sensors_range.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Code source du projet Voiture Assistée
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Python library to interact with Move Hub / PoweredUp Hubs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><em>Move Hub is central controller block of <a href="https://www.lego.com/themes/boost">LEGO® Boost Robotics Set</a>.</em></p>
<p>In fact, Move Hub is just a Bluetooth hardware piece, and all manipulations with it are made by commands passed through Bluetooth Low Energy (BLE) wireless protocol. One of the ways to issue these commands is to write Python program using this library.</p>
<p>The best way to start is to look into <a href="examples/demo.py"><code>demo.py</code></a> file, and run it (assuming you have installed library).</p>
<p>If you have Vernie assembled, you might run scripts from <a href="examples/vernie"><code>examples/vernie</code></a> directory.</p>
<h1><a class="anchor" id="autotoc_md150"></a>
Demonstrational Videos</h1>
<p><a href="http://www.youtube.com/watch?v=oqsmgZlVE8I"><img src="http://img.youtube.com/vi/oqsmgZlVE8I/0.jpg" alt="Vernie Programmed" class="inline"/></a> <a href="https://youtu.be/ZbKmqVBBMhM"><img src="http://img.youtube.com/vi/ZbKmqVBBMhM/0.jpg" alt="Laser Engraver" class="inline"/></a> <a href="https://youtu.be/829RKT8v8M0"><img src="http://img.youtube.com/vi/829RKT8v8M0/0.jpg" alt="Color Sorter" class="inline"/></a> <a href="https://youtu.be/WUOa3j-6XfI"><img src="http://img.youtube.com/vi/WUOa3j-6XfI/0.jpg" alt="Face Tracker" class="inline"/></a> <a href="https://youtu.be/QY6nRYXQw_U"><img src="http://img.youtube.com/vi/QY6nRYXQw_U/0.jpg" alt="Color Pin Bot" class="inline"/></a> <a href="https://youtu.be/55kE9I4IQSU"><img src="http://img.youtube.com/vi/55kE9I4IQSU/0.jpg" alt="BB-8 Joystick" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md151"></a>
Features</h1>
<ul>
<li>auto-detect and connect to <a class="el" href="md__c___users__b_d_c_c_source_repos__a_c_k_e_r_m_a_n_n_g_u_e__a_g__dipl__tech_2021__voiture_assi4c7b49fdc14a79ee857b6b976a05f13c.html">Move Hub</a> device</li>
<li>auto-detects <a class="el" href="md__c___users__b_d_c_c_source_repos__a_c_k_e_r_m_a_n_n_g_u_e__a_g__dipl__tech_2021__voiture_assi294c8b37f7ad13b5bdef7fe03251fbc5.html">peripheral devices</a> connected to Hub</li>
<li>constant, angled and timed movement for <a class="el" href="md__c___users__b_d_c_c_source_repos__a_c_k_e_r_m_a_n_n_g_u_e__a_g__dipl__tech_2021__voiture_assi1a323e1918f1ec3585062f9f1902ae5f.html">motors</a>, rotation sensor subscription</li>
<li><a class="el" href="md__c___users__b_d_c_c_source_repos__a_c_k_e_r_m_a_n_n_g_u_e__a_g__dipl__tech_2021__voiture_assi6fff73905fd257b6a3ece64c6188f1c7.html">vision sensor</a>: several modes to measure distance, color and luminosity</li>
<li><a class="el" href="md__c___users__b_d_c_c_source_repos__a_c_k_e_r_m_a_n_n_g_u_e__a_g__dipl__tech_2021__voiture_assi19e8595b2fc5f070fb3511b3b73df4b9.html">tilt sensor</a> subscription: 2 axis, 3 axis, bump detect modes</li>
<li><a class="el" href="md__c___users__b_d_c_c_source_repos__a_c_k_e_r_m_a_n_n_g_u_e__a_g__dipl__tech_2021__voiture_assi3c89e09b44d41f02a57c9d3ac49bfa52.html">RGB LED</a> color change</li>
<li><a href="docs/MoveHub.md#push-button">push button</a> status subscription</li>
<li><a class="el" href="md__c___users__b_d_c_c_source_repos__a_c_k_e_r_m_a_n_n_g_u_e__a_g__dipl__tech_2021__voiture_assi2be5a0d5c2776b8a18c54a9fa1d865e5.html">battery voltage and current</a> subscription available</li>
<li>permanent Bluetooth connection server for faster debugging</li>
</ul>
<h1><a class="anchor" id="autotoc_md152"></a>
Usage</h1>
<p><em>Please note that this library requires one of Bluetooth backend libraries to be installed, please read section <a href="#bluetooth-backend-prerequisites">here</a> for details.</em></p>
<p>Install library like this: </p><div class="fragment"><div class="line">pip install -U pylgbst</div>
</div><!-- fragment --><p>Then instantiate MoveHub object and start invoking its methods. Following is example to just print peripherals detected on Hub: <br  />
</p>
<div class="fragment"><div class="line">from pylgbst.hub import MoveHub</div>
<div class="line"> </div>
<div class="line">hub = MoveHub()</div>
<div class="line"> </div>
<div class="line">for device in hub.peripherals:</div>
<div class="line">    print(device)</div>
</div><!-- fragment --><p>Each peripheral kind has own methods to do actions and/or get sensor data. See <a href="#features">features</a> list for individual doc pages.</p>
<h1><a class="anchor" id="autotoc_md153"></a>
Bluetooth Backend Prerequisites</h1>
<p>You have following options to install as Bluetooth backend (some of them might require <code>sudo</code> on Linux):</p>
<ul>
<li><code>pip install pygatt</code> - <a href="https://github.com/peplin/pygatt">pygatt</a> lib, works on both Windows and Linux <br  />
</li>
<li><code>pip install gatt</code> - <a href="https://github.com/getsenic/gatt-python">gatt</a> lib, supports Linux, does not work on Windows</li>
<li><code>pip install gattlib</code> - <a href="https://bitbucket.org/OscarAcena/pygattlib">gattlib</a> - supports Linux, does not work on Windows, requires <code>sudo</code></li>
<li><code>pip install bluepy</code> - <a href="https://github.com/IanHarvey/bluepy">bluepy</a> lib, supports Linux, including Raspbian, which allows connection to the hub from the Raspberry PI</li>
<li><code>pip install bleak</code> - <a href="https://github.com/hbldh/bleak">bleak</a> lib, supports Linux/Windows/MacOS</li>
</ul>
<p>Windows users may first turn to the Bleak backend, which should support any internal or external Bluetooth adapter recognized by the OS. The Windows version of pygatt will only work with a <a href="https://www.silabs.com/products/wireless/bluetooth/bluetooth-low-energy-modules/bled112-bluetooth-smart-dongle">Bluegiga BLED112 Bluetooth Smart Dongle</a>.</p>
<p><em>Please let author know if you have discovered any compatibility/preprequisite details, so we will update this section to help future users</em></p>
<p>Depending on backend type, you might need Linux <code>sudo</code> to be used when running Python.</p>
<h2><a class="anchor" id="autotoc_md154"></a>
Bluetooth Connection Options</h2>
<p>There is an optional parameter for <code>MoveHub</code> class constructor, accepting instance of <code>Connection</code> object. By default, it will try to use whatever <code><a class="el" href="namespacepylgbst.html#a9c7d0d286d4b7edc41cfb9385f8c613a">get_connection_auto()</a></code> returns. You have several options to manually control that:</p>
<ul>
<li>use <code><a class="el" href="namespacepylgbst.html#a9c7d0d286d4b7edc41cfb9385f8c613a">get_connection_auto()</a></code> to attempt backend auto-detection</li>
<li>use <code><a class="el" href="namespacepylgbst.html#a46ef198a09d4ca57afafe840b2cf952a">get_connection_bluegiga()</a></code> - if you use BlueGiga Adapter (<code>pygatt</code> library prerequisite)</li>
<li>use <code><a class="el" href="namespacepylgbst.html#ab1633655af5a30f3be8b86c3b24045e6">get_connection_gatt()</a></code> - if you use Gatt Backend on Linux (<code>gatt</code> library prerequisite)</li>
<li>use <code><a class="el" href="namespacepylgbst.html#a2cb026ad2a6a647f1f4a578ee75ae9ed">get_connection_gattool()</a></code> - if you use GattTool Backend on Linux (<code>pygatt</code> library prerequisite)</li>
<li>use <code><a class="el" href="namespacepylgbst.html#a6882e3a158e7b875ba81f6f14652a207">get_connection_gattlib()</a></code> - if you use GattLib Backend on Linux (<code>gattlib</code> library prerequisite)</li>
<li>use <code><a class="el" href="namespacepylgbst.html#a92fccb7fa129c6dde2c43133c2c763cb">get_connection_bluepy()</a></code> - if you use Bluepy backend on Linux/Raspbian (<code>bluepy</code> library prerequisite)</li>
<li>use <code><a class="el" href="namespacepylgbst.html#a47588c690d72563c7501dbde2e16228f">get_connection_bleak()</a></code> - if you use Bleak backend (<code>bleak</code> library prerequisite)</li>
<li>pass instance of <code>DebugServerConnection</code> if you are using <a href="#debug-server">Debug Server</a> (more details below).</li>
</ul>
<p>All the functions above have optional arguments to specify adapter name and Hub name (or mac address). Please take a look at functions source code for details.</p>
<p>If you want to specify name for Bluetooth interface to use on local computer, you can pass that to class or function of getting a connection. Then pass connection object to <code>MoveHub</code> constructor. Like this: </p><div class="fragment"><div class="line">from pylgbst.hub import MoveHub</div>
<div class="line">from pylgbst import get_connection_gatt</div>
<div class="line"> </div>
<div class="line">conn = get_connection_gatt(hub_mac=&#39;AA:BB:CC:DD:EE:FF&#39;)</div>
<div class="line">hub = MoveHub(conn)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md155"></a>
Debug Server</h1>
<p>Running debug server opens permanent BLE connection to Hub and listening on TCP port for communications. This avoids the need to re-start Hub all the time.</p>
<p>There is <code>DebugServerConnection</code> class that you can use with it, instead of <code>BLEConnection</code>.</p>
<p>Starting debug server is done like this (you may need to run it with <code>sudo</code>, depending on your BLE backend): </p><div class="fragment"><div class="line">python -c &quot;import logging; logging.basicConfig(level=logging.DEBUG); \</div>
<div class="line">                import pylgbst; pylgbst.start_debug_server()&quot;</div>
</div><!-- fragment --><p>Then push green button on MoveHub, so permanent BLE connection will be established.</p>
<h1><a class="anchor" id="autotoc_md156"></a>
Roadmap &amp; TODO</h1>
<ul>
<li>validate operations with other Hub types (train, PUP etc)</li>
<li>make connections to detect hub by UUID instead of name</li>
<li>document all API methods</li>
<li>make debug server to re-establish BLE connection on loss</li>
</ul>
<h1><a class="anchor" id="autotoc_md157"></a>
Links</h1>
<ul>
<li><a href="https://github.com/LEGO/lego-ble-wireless-protocol-docs">https://github.com/LEGO/lego-ble-wireless-protocol-docs</a> - true docs for LEGO BLE protocol</li>
<li><a href="https://github.com/JorgePe/BOOSTreveng">https://github.com/JorgePe/BOOSTreveng</a> - initial source of protocol knowledge</li>
<li><a href="https://github.com/nathankellenicki/node-poweredup">https://github.com/nathankellenicki/node-poweredup</a> - JavaScript version of library</li>
<li><a href="https://github.com/spezifisch/sphero-python/blob/master/BB8joyDrive.py">https://github.com/spezifisch/sphero-python/blob/master/BB8joyDrive.py</a> - example with another approach to bluetooth libs</li>
<li><a href="https://github.com/virantha/bricknil">https://github.com/virantha/bricknil</a> - for the lovers of async Python, alternative implementation of library to control PoweredUp Hubs </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
