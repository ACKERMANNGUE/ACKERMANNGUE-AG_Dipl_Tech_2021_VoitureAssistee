<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Code source du projet Voiture Assistée: Setting up a development environment</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_voiture_flatdesign_sensors_range.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Code source du projet Voiture Assistée
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Setting up a development environment </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the recommended development environment used by the Pybricks maintainers.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Requirements</h2>
<ul>
<li>Ubuntu 20.04 (Focal Fossa)</li>
<li><a href="https://git-scm.com/downloads">Git SCM</a> any recent-ish version</li>
<li><a href="https://code.visualstudio.com/Download">VS Code</a> latest version</li>
<li><a href="https://www.python.org/downloads/">Python</a> v3.8.x</li>
<li><a href="https://python-poetry.org/docs/">Poetry</a> v1.x</li>
<li><a href="http://uncrustify.sourceforge.net/">Uncrustify</a> v0.71.x</li>
<li><a href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads">GNU ARM Embedded Toolchain</a> v10-2020-q4</li>
<li><a href="https://gcc.gnu.org/">GNU GCC</a> for host operating system</li>
<li><a href="https://www.gnu.org/software/make/">GNU Make</a></li>
</ul>
<p>Optional:</p><ul>
<li><a href="https://docs.docker.com/engine/install/ubuntu/">Docker</a> (only needed if building for <a class="el" href="namespaceev3dev.html">ev3dev</a>)</li>
<li><a href="https://emscripten.org/docs/getting_started/downloads.html">Emscripten</a> v1.39.x (only needed if building mpy-cross JavaScript package)</li>
<li><a href="https://classic.yarnpkg.com/en/docs/install">Yarn</a> v1.x (only needed if building JavaScript packages)</li>
</ul>
<h2><a class="anchor" id="autotoc_md33"></a>
Installation tips</h2>
<h3><a class="anchor" id="autotoc_md34"></a>
Pipx</h3>
<p>We recommend using <a href="https://pipxproject.github.io/pipx/">pipx</a> to install and manage python command line tools like Poetry.</p>
<p>Linux (Ubuntu): </p><pre class="fragment">sudo apt update &amp;&amp; sudo apt install python-pipx
</pre><p> macOS: </p><pre class="fragment">brew install pipx
</pre><p> Windows: </p><pre class="fragment">py -3 -m pip install pipx
</pre><p>Then install tools like this: </p><pre class="fragment">pipx install poetry
</pre><h3><a class="anchor" id="autotoc_md35"></a>
Ubuntu</h3>
<p>Some of the prerequisites are available as Debian packages. The correct version of <code>uncrustify</code> is available via the Pybricks PPA. The <code>build-essential</code> package gets the GCC compiler for the host system and Make. </p><pre class="fragment">sudo apt-add-repository ppa:pybricks/ppa
sudo apt update
sudo apt install git python3 uncrustify build-essential
</pre><p> Other tools (VS Code, Poetry, ARM Embedded Toolchain, Docker) can be installed via the recommended install methods found in the links above.</p>
<h3><a class="anchor" id="autotoc_md36"></a>
Windows</h3>
<p>We use <a href="https://www.cygwin.com/">Cygwin</a> for building code on Windows. Download and install Cygwin from the link. Select the following packages during installation: </p><pre class="fragment">doxygen
graphviz
make
mingw64-x86_64-gcc-core
python3
zip
</pre><p> Cygwin and the <a href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads">GNU ARM Embedded Toolchain</a> need to be added to the <code>PATH</code> environment variable. We recommend doing this in the local terminal rather than globally via <em>System Properties</em>. For example using PowerShell:</p>
<div class="fragment"><div class="line">$env:PATH=&quot;C:\cygwin64\bin;C:\Program Files (x86)\GNU Arm Embedded Toolchain\10 2020-q4-major\bin;$env:PATH&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37"></a>
Get the code</h2>
<h3><a class="anchor" id="autotoc_md38"></a>
Via VS Code</h3>
<p>There is a <code>Git: clone</code> command available via the command pallette.</p>
<p>TODO:</p><ul>
<li>Does GitHub extension need to be installed first?</li>
<li>Screenshots</li>
</ul>
<h3><a class="anchor" id="autotoc_md39"></a>
Via GitHub Desktop</h3>
<p>If you have never used Git before, <a href="https://desktop.github.com/">GitHub Desktop</a> is a nice tool that does just the basics.</p>
<p>TODO:</p><ul>
<li>Screenshots</li>
</ul>
<h3><a class="anchor" id="autotoc_md40"></a>
Via command line</h3>
<p>Note: although <code>pybricks-micropython</code> contains submodules, we don't recommend using the <code>--recursive</code> option. There are many submodules from MicroPython that are not used by Pybricks and take a long time to clone. Submodules will be checkout out on-demand when running <code>make</code>. </p><pre class="fragment">git clone https://github.com/pybricks/pybricks-micropython
cd pybricks-micropython
code . # Opens the project in VS Code
</pre> <h2><a class="anchor" id="autotoc_md41"></a>
Set up the Python environment</h2>
<p>There are a few special Python packages needed by the build system and other tools, so we are using Poetry to manage these requirements and set up a virtual environment to isolate the installation so you don't break your main Python runtime.</p>
<p>Open a terminal in the <code>pybricks-micropython</code> directory where you cloned the source code, then run: </p><pre class="fragment">poetry env info
</pre><p> Verify that the Python version listed is 3.8.x. If it is not, run: </p><pre class="fragment">poetry env use &lt;path-to-python3.8&gt;
</pre><p> where <code>&lt;path-to-python3.8&gt;</code> is the full path to the Python 3.8 installation.</p>
<p>Then run the following to set up the Python environment: </p><pre class="fragment">poetry install
</pre><p> To activate the environment, run: </p><pre class="fragment">poetry shell
</pre><p> The command prompt will now start with <code>(.venv)</code> to remind you that you are working in the virtual environment. You should run <code>poetry shell</code> any time you open a new terminal window while working on <code>pybricks-micropython</code>.</p>
<h2><a class="anchor" id="autotoc_md42"></a>
Set up VS Code</h2>
<p>When using the Microsoft C/C++ extension for VS Code, you will need to set the <code>GCC_10_ARM_NONE_EABI_BIN</code> environment variable to the directory where the Arm toolchain was installed so that it can find the compiler to assist with code analysis. See <a href=".vscode/c_cpp_properties.json">.vscode/c_cpp_properties.json</a> for more info.</p>
<h1><a class="anchor" id="autotoc_md43"></a>
Building the code</h1>
<p>After setting up a development environment as described above, open a terminal in the <code>pybricks-micropython</code> directory.</p>
<p>If you are building firmware for a Powered Up hub, first you will need to make sure that the cross-compiler can be found. This can be done by adding it to the <code>PATH</code> environment variable as described in the ARM Embedded Toolchain <code>readme.txt</code> file: </p><pre class="fragment">export PATH=$PATH:$install_dir/gcc-arm-none-eabi-*/bin
</pre><p> Or by setting the <code>CROSS_COMPILE</code> environment variable: </p><pre class="fragment">export CROSS_COMPILE=$install_dir/gcc-arm-none-eabi-*/bin
</pre><p> <code>$install_dir</code> needs to be replaced with the actual directory where you actually installed the toolchain.</p>
<p>Then run: </p><pre class="fragment">make &lt;target&gt;
</pre><p> Where <code>&lt;target&gt;</code> is one of the bricks listed in the <code>bricks/</code> directory, e.g. <code>cityhub</code>.</p>
<p>Hopefully all goes well and the firmware builds. The results of the build can be found in <code>bricks/&lt;target&gt;/build/</code>.</p>
<h1><a class="anchor" id="autotoc_md44"></a>
Submitting changes</h1>
<p>We welcome <a href="https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests">pull requests</a> to fix bugs in <code>pybricks-micropython</code>. However, due to the extremely limited flash memory in the Powered Up hubs, we will probably not accept new features unless they are considered "essential". Please open an issue to discuss first if you are not sure if something will be acceptable.</p>
<p>Changes should also follow the guidelines below:</p>
<h2><a class="anchor" id="autotoc_md45"></a>
Coding style</h2>
<p>For the most part, we follow the <a href="https://github.com/micropython/micropython/blob/master/CODECONVENTIONS.md">MicroPython coding style</a>. There are some 3rd party libraries that don't follow this style, so in those cases, the style should match the rest of the code in the file that is being changed.</p>
<p>Before committing your changes, be sure to run: </p><pre class="fragment">poetry run ./tools/codeformat.py
</pre><p> This will automatically fix common problems in files that follow the MicroPython style.</p>
<h2><a class="anchor" id="autotoc_md46"></a>
Logical commits</h2>
<p>Complex changes should be split into smaller changes, each performing a logical step towards the end goal. Each commit on its own should be able to be compiled without error. This helps code reviewers and makes finding regressions easier.</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Commit messages</h2>
<p>Please follow the recommendations below to write a <em>useful</em> commit message.</p>
<ol type="1">
<li>Add a prefix to the subject line that gives the area of code that is changed. Usually this will be the relative file path of the file being changed.<ul>
<li>If the change is to the pbio library, omit the <code>lib/</code> part of the path.</li>
<li>For changes to the implementation of the <code>pybricks</code> package, use import path instead of the file path, as in <a href="https://github.com/pybricks/pybricks-micropython/commit/f45333e76d3c946ea1a5932745fe76573263b9d6">this example</a>.</li>
</ul>
</li>
<li>The rest of the subject line describes <em>what</em> changed.</li>
<li>The body describes <em>why</em> the change was made.</li>
<li>Include other relevant information in the commit message if applicable. For example, if the commit fixes a compiler error, include a copy of the error message.</li>
<li>Include a link to the relevant GitHub issue, if applicable.</li>
<li>Include the change in firmware size, if applicable.</li>
<li>Look at the <a href="https://github.com/pybricks/pybricks-micropython/commits/master">git history</a> for more examples.</li>
</ol>
<h1><a class="anchor" id="autotoc_md48"></a>
Building JavaScript packages</h1>
<p>This is not needed in the course of normal development, but we have several JavaScript packages that are build from this repository.</p>
<h2><a class="anchor" id="autotoc_md49"></a>
firmware</h2>
<p>This package is for distributing the Pybricks firmware.</p>
<p>In the <code>pybricks-micropython</code> directory: </p><pre class="fragment">cd npm/firmware
yarn install
yarn build
</pre><h2><a class="anchor" id="autotoc_md50"></a>
mpy-cross</h2>
<p>This package is for distributing <code>mpy-cross</code> as a <a href="https://webassembly.org/">Web Assembly</a> binary. To build it, we need <a href="https://emscripten.org/docs/getting_started/downloads.html">Emscripten</a> v1.39.12 installed. Then make sure to activate the environment: </p><pre class="fragment">source $emsdk_path/emsdk_env.sh
</pre><p> ...where <code>$emsdk_path</code> is the folder where the Emscripten SDK is installed.</p>
<p>Then in the <code>pybricks-micropython</code> directory: </p><pre class="fragment"># ensure that mpy-cross has been built - we need the generated files
make -C micropython/mpy-cross

cd npm/mpy-cross
yarn install
yarn build:debug
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
