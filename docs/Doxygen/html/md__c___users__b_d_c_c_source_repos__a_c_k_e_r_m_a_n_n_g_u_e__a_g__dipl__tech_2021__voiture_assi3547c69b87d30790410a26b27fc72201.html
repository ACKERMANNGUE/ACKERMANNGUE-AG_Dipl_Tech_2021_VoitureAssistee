<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Code source du projet Voiture Assistée: pyb00st</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_voiture_flatdesign_sensors_range.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Code source du projet Voiture Assistée
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespacepyb00st.html">pyb00st</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Python for LEGO BOOST</p>
<p>The LEGO BOOST Move Hub is a BLE (Bluetooth Low Energy) device like the LEGO WeDo 2.0 Smart Hub and the Vengit SBrick which I already managed to control with the LEGO MINDSTORMS EV3 thanks to <a href="https://bitbucket.org/OscarAcena/pygattlib">pygattlib</a>, a python library for BLE.</p>
<p>I've been <a href="https://github.com/JorgePe/BOOSTreveng">reverse engineering the LEGO BOOST</a> Move Hub and since I'm now officially crazy I decided to try to write a python package.</p>
<p>I started this project with pygattlib. It's a library that makes direct use of BlueZ and has been included in pybluez. But since python3 version of pygattlib has problems with notifications I started to use a different library, <a href="https://github.com/peplin/pygatt/tree/master/pygatt">pygatt</a>, that doesn't make direct use of Bluez - instead, it makes use of a <em>backend</em>. On linux systems this backend can be BlueZ (through system calls to BlueZ commands like hcitool and gattool) but on other systems (and probably also on linux aswell) it uses a different backend, based on BlueGiga's API - so a BG adapter, like BLED112, is needed.</p>
<p>Why did I call it <a class="el" href="namespacepyb00st.html">pyb00st</a>? Well, boost is a C++ library and there are already lots of python libraries related to it and I don't want to add the LEGO word because I don't want troubles.</p>
<p>By the way...</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Disclaimer:</h1>
<p>LEGO and BOOST are Trademarks from The LEGO Company, which does not support (most probably doesn't even know about) this project. And of course I'm not responsible for any damage on your LEGO BOOST devices.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Requirements</h1>
<p>Inititally, <a class="el" href="namespacepyb00st.html">pyb00st</a> was intended for linux only (don't give up yet, good news ahead) because I was using a python library (pygattlib) that only works with BlueZ (the Linux bluetooth stack). Lately I was forced to use a different library and I am now using <a href="https://github.com/peplin/pygatt/tree/master/pygatt">pygatt</a> (not pygattlib) that can also work on non-linux systems <b>if</b> a BlueGiga adapter is available.</p>
<p>Python 3 is also needed. It is not a really requirement <em>per se</em> but I want to use <a class="el" href="namespacepyb00st.html">pyb00st</a> with LEGO MINDSTORMS EV3 (by running <a class="el" href="namespaceev3dev.html">ev3dev</a>) and since python 2 is no longer supported by the project I had no choice (and really, python 2 has to go some day).</p>
<p>And, of course, a BLE controller is also required. On linux systems, any Bluetooth 4.0 BLE device is OK as long as it is supported by the kernel. On other systems a BlueGiga adapter (like the BLED112) is required (it also works on linux, by the way).</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Supported environments</h1>
<p>As I only have linux systems, most tests are done on my Ubuntu laptop (17.04, x64) and, of course, on MINDSTORMS EV3 running <a class="el" href="namespaceev3dev.html">ev3dev</a>. Ocasionally, I also test on my Raspberry Pi 3 and Pi Zero W, running <a class="el" href="namespaceev3dev.html">ev3dev</a> or Raspbian. I wrote a short tutorial on <a href="https://github.com/JorgePe/pyb00st/blob/master/linux.md">how to install and use pyb00st on linux</a>.</p>
<p>I now also test <a class="el" href="namespacepyb00st.html">pyb00st</a> on a Windows 10 Virtual Machine but I have no means to test on OSX. It's supposed to work but that's all I can say.</p>
<p>On linux, the BlueZ backend approach results in slower performance than pygattlib and there seems to be a stability problem with the HCI controller. But it also requires much less dependencies... If this affects you, perhaps it's better to use the BlueGiga backend also on linux.</p>
<p>The old version of <a class="el" href="namespacepyb00st.html">pyb00st</a> based on pygattlib is still available on 'other' folder but it lacks all input methods and several other developments. If problems with nofications on python 3 ever gets fixed, I'll probably backport all code but for now is freeze.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Status:</h1>
<p>The package implements: <br  />
</p><ul>
<li>A few constants <br  />
</li>
<li>A MoveHub class with some methods, including: <br  />
<ul>
<li>controlling RGB LED color <br  />
</li>
<li>controlling Interactive motors (timed and angle)</li>
<li>reading Color Sensor <br  />
</li>
<li>reading Distance Sensor</li>
<li>reading Motor Encoders</li>
<li>reading Button <br  />
</li>
<li>reading Tilt (Basic Mode) <br  />
</li>
<li>controlling WeDo Motors - works also with old 9V and PF 1.0 motors <br  />
</li>
<li>reading WeDo 2.0 Tilt Sensor <br  />
</li>
<li>reading WeDo 2.0 Distance Sensor (missing some modes)</li>
</ul>
</li>
</ul>
<p>I've made good progress with the pygatt version and I'm now considering this code 'beta' level, bull still need to polish it a bit and make detailed tests.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Installation</h1>
<p><a class="el" href="namespacepyb00st.html">pyb00st</a> is far from being a full pyhton package that you can install with <code>pip</code>.</p>
<p>You need to download at least the files present inside the <code><a class="el" href="namespacepyb00st.html">pyb00st</a></code> folder. If you are not familliar with git just click the green "Clone or download" button and download the zip file. Extract the zip file to a folder of your choice, like <code><a class="el" href="namespacepyb00st.html">pyb00st</a></code>. And perhaps you want to add the path to this folder to PYTHONPATH environment variable.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Usage</h1>
<p><a class="el" href="namespacepyb00st.html">pyb00st</a> implements one class: MoveHub(address, backend, controller)</p>
<p><code>address</code> is the the Bluetooth address of your LEGO BOOST Move Hub (like "00:16:53:A4:CD:7E").</p>
<p><code>backend</code> chooses the pygatt backend. There are 3 options: 'Auto', 'BlueZ' and 'BlueGiga'.</p><ul>
<li>'Auto' always tries to use the BlueGiga adapter but on linux, if no adapter is found, it reverts to BlueZ and uses the specified <code>controller</code></li>
<li>'Bluez' only works on linux ((like Ubuntu, Raspbian and <a class="el" href="namespaceev3dev.html">ev3dev</a>)), it uses the BlueZ backend with the specified <code>controller</code></li>
<li>'BlueGiga' uses the BlueGiga backeend with a compatible adapter and just ignores <code>controller</code></li>
</ul>
<p><code>controller</code> is only required in linux with 'BlueZ' backend, it's the HCI name of the Bluetooth BLE controller (like 'hci0'). It's not used with 'BlueGiga' backend so just '' is enough.</p>
<p>When you <code>start()</code> a MoveHub object a BLE session is created from the specified controller. Sometimes this session doesn't succeed so you may need to retry it. And although I never saw a stablished connection drop, you should not assume that it is permanent.</p>
<p>It is possible to instantiate several MoveHub objects. as long as you have one BT BLE controller for each. Currently, this is only possible in linux (and never tested, I only one Move Hub).</p>
<p>Each MoveHub object has it's own internal and external ports, associated to devices. Currently, there is no method to check for the presence (and addition or removal) of external devices, so we need to assume it on our code.</p>
<p>Each MoveHub has Input and Output methods to deal with each device.</p>
<p>We can use Output methods directly but for using Input methods we fist need to <code>subscribe</code> notifications that are sent from the MoveHub containing information about the devices that are currently active.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Available methods:</h2>
<ul>
<li>General methods:<ul>
<li>start()</li>
<li><a class="el" href="namespaceexamples_1_1bb8joystick.html#af8dedb215cbc1b44181d4c6431228735">stop()</a></li>
<li>is_connected()</li>
<li>get_address()</li>
<li>get_name()</li>
</ul>
</li>
<li>Output methods:<ul>
<li>run_motor_for_time(motor, time_ms, dutycycle_pct)</li>
<li>run_motors_for_time(motors, time_ms, dutycycle_pct_a, dutycycle_pct_b)</li>
<li>run_motor_for_angle(motor, angle, dutycycle_pct)</li>
<li>run_motor_for_angles(motors, angle, dutycycle_pct_a, dutycycle_pct_b)</li>
<li>motor_wedo(port, dutycycle_pct)</li>
<li>set_hublight(color)</li>
</ul>
</li>
<li>Input methods:<ul>
<li>subscribe_all()</li>
<li>listen_colordist_sensor(port)</li>
<li>listen_angle_sensor(port)</li>
<li>listen_button()</li>
<li>listen_hubtilt(mode)</li>
<li>listen_wedo_tilt(port, mode)</li>
<li>listen_wedo_distance(port, mode)</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
Examples:</h1>
<h2><a class="anchor" id="autotoc_md15"></a>
Example 1 - simple connection</h2>
<p>Assuming you have <a class="el" href="namespacepyb00st.html">pyb00st</a> files inside a folder named <code><a class="el" href="namespacepyb00st.html">pyb00st</a></code>, this example will connect to your LEGO BOOST Move Hub and print it's name:</p>
<div class="fragment"><div class="line">#!/usr/bin/env python3</div>
<div class="line"> </div>
<div class="line">from pyb00st.movehub import MoveHub</div>
<div class="line">from pyb00st.constants import *</div>
<div class="line"> </div>
<div class="line">mymovehub = MoveHub(&#39;00:16:53:A4:CD:7E&#39;, &#39;Auto&#39;, &#39;hci0&#39;)</div>
<div class="line"> </div>
<div class="line">try:</div>
<div class="line">    mymovehub.start()</div>
<div class="line">    print(mymovehub.get_name())</div>
<div class="line"> </div>
<div class="line">finally:</div>
<div class="line">    mymovehub.stop()</div>
</div><!-- fragment --><p>It will also run on Windows, as long as you have a BlueGiga adapter like the BLED112. In that case, the 'hci0' argument is just ignored, the BGAPIBackend will autodiscovery it.</p>
<p>The <code><a class="el" href="namespaceexamples_1_1bb8joystick.html#af8dedb215cbc1b44181d4c6431228735">stop()</a></code> method closes the BLE session. With BlueGiga adapters it is absolutely required: if we don't instruct the BG adapter to do it, we will have to power off the Move Hub manually. On linux, the GATTool backend automatically closes after a timeout.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Example 2 - simple output</h2>
<p>This second example turns motor A ON for 1000 ms at 100% duty cycle, first in one direction then in the opposite direction - "Duty cycle" is a term used in Pulse Width Modulation, it can be interpreted as "power" or incorrectly as "speed":</p>
<div class="fragment"><div class="line">#!/usr/bin/env python3</div>
<div class="line"> </div>
<div class="line">from pyb00st.movehub import MoveHub</div>
<div class="line">from pyb00st.constants import *</div>
<div class="line">from time import sleep</div>
<div class="line"> </div>
<div class="line">MY_MOVEHUB_ADD = &#39;00:16:53:A4:CD:7E&#39;</div>
<div class="line">MY_BTCTRLR_HCI = &#39;hci0&#39;</div>
<div class="line"> </div>
<div class="line">mymovehub = MoveHub(MY_MOVEHUB_ADD, &#39;Auto&#39;, MY_BTCTRLR_HCI)</div>
<div class="line"> </div>
<div class="line">try:</div>
<div class="line">    mymovehub.start()</div>
<div class="line">    mymovehub.run_motor_for_time(MOTOR_A, 1000, 100)</div>
<div class="line">    sleep(1)</div>
<div class="line">    mymovehub.run_motor_for_time(MOTOR_A, 1000, -100)</div>
<div class="line">    sleep(1)</div>
<div class="line"> </div>
<div class="line">finally:</div>
<div class="line">    mymovehub.stop()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
Example 3 - simple input</h2>
<p>This third example activates the internal tilt sensor and continuously polls its state:</p>
<div class="fragment"><div class="line">#!/usr/bin/env python3</div>
<div class="line"> </div>
<div class="line">from pyb00st.movehub import MoveHub</div>
<div class="line">from pyb00st.constants import *</div>
<div class="line">from time import sleep</div>
<div class="line"> </div>
<div class="line">MY_MOVEHUB_ADD = &#39;00:16:53:A4:CD:7E&#39;</div>
<div class="line">MY_BTCTRLR_HCI = &#39;hci0&#39;</div>
<div class="line"> </div>
<div class="line">mymovehub = MoveHub(MY_MOVEHUB_ADD, &#39;Auto&#39;, MY_BTCTRLR_HCI)</div>
<div class="line"> </div>
<div class="line">try:</div>
<div class="line">    mymovehub.start()</div>
<div class="line">    mymovehub.subscribe_all()</div>
<div class="line">    mymovehub.listen_hubtilt(MODE_HUBTILT_BASIC)</div>
<div class="line"> </div>
<div class="line">    while True:</div>
<div class="line">        sleep(0.2)</div>
<div class="line">        if mymovehub.last_hubtilt in TILT_BASIC_VALUES:</div>
<div class="line">            print(TILT_BASIC_TEXT[mymovehub.last_hubtilt])</div>
<div class="line"> </div>
<div class="line">finally:</div>
<div class="line">    mymovehub.stop()</div>
</div><!-- fragment --><p>Currently there is no way to de-activate a device or cancel a subscription. Will take care of that later.</p>
<h1><a class="anchor" id="autotoc_md18"></a>
Documentation</h1>
<p>I'll write some documentation later. For now, see 'examples' folder in the source code tree.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Roadmap</h1>
<ul>
<li>Keep reading the <a href="https://www.python.org/dev/peps/pep-0008/">python styling guide</a>.</li>
<li>Add some input and output methods:<ul>
<li>battery (still not understood)</li>
<li>read enconder of port group A+B</li>
<li>deactivate sensors</li>
<li>check BLE connection (tricky)</li>
<li>read Hub tilt in full mode</li>
<li>read ambient light level</li>
</ul>
</li>
<li>Improve all methods</li>
<li>Keep learning python :)</li>
<li>Exception handling, multithreading and all that black magic </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
